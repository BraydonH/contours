<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
  <meta charset="utf-8">
  <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
  <script src="lib/leaflet-hash.js"></script>
  <script src="https://d3js.org/d3-selection.v1.min.js"></script>
  <script src="https://d3js.org/d3-contour.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo.v1.min.js"></script>
  <script src="https://d3js.org/d3-array.v1.min.js"></script>
  <script src="https://d3js.org/d3-collection.v1.min.js"></script>
  <script src="https://d3js.org/d3-color.v1.min.js"></script>
  <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
  <script src="https://d3js.org/d3-scale.v2.min.js"></script>
  <script src="https://d3js.org/d3-request.v1.min.js"></script>
  <script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
  <style>
    html, body { 
      margin: 0;
      font-family: 'Roboto', sans-serif;
      font-size: 12px;
      color: #111;
    }
    #wrapper {
      position: relative;
    }
    #map {
      width: 100%;
      height: 100%;
    }
    #settings, #download {
      position: absolute;
      z-index: 1000;
      background-color: white;
      border-radius: 5px;
      padding: 20px;
      bottom: 20px;
      left: 50%;
      box-sizing: border-box;
      width: 700px;
      margin-left: -350px;
      box-shadow: 0 0 10px rgba(0,0,0,.5);
      display: none;
    }
    #settings.show, #download.show {
      display: block;
    }
    #settings-toggle, #download-toggle {
      position: absolute;
      z-index: 1000;
      bottom: 20px;
      left: 20px;
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,.5);
      padding: 10px;
      cursor: pointer;
      width: 50px;
      height: 50px;
      background-position: center center;
      background-repeat: no-repeat;
      background-size: 90%;
    }
    #settings-toggle:hover, #download-toggle:hover {
      box-shadow: 0 0 10px rgba(0,0,0,1);
    }
    #download-toggle {
      left: auto;
      right: 20px;
      background-image: url(download.png);
    }
    #settings-toggle {
      background-image: url(palette.png);
    }
    .settings-title {
      margin: 0 0 10px 0;
      font-size: 1.5rem;
      color: #666;
      vertical-align: middle;
    }
    #download .settings-title {
      cursor: pointer;
    }
    .settings-row {
      margin-bottom: 25px;
    }
    .settings-section {
      margin-right: 15px;
    }
    input[type="radio"] {
      -webkit-appearance: none;
      appearance: none;
    }
    input[type="radio"] + span{
      color: #999;
      cursor: pointer;
      border: 1px solid transparent;
      padding: 5px;
      border-radius: 5px;
    }
    input[type="radio"] + span:hover{
      background-color: #f7f7f7;
    }
    input[type="radio"]:checked + span{
      color: #111;
      font-weight: bold;
      display: inline-block;
      border-color: #999;
      background-color: #f7f7f7;
    }
    #settings input[type="text"] {
      width: 40px;
      font-size: 12px;
      padding: 5px;
      text-align: center;
    }
    #settings input#interval-input {
      width: 50px;
    }
    canvas {position: absolute; top:0; left:0;}
    .leaflet-container{ background: white;}

    .settings-row div {
      display: inline-block;
    }

    #solid-style, #hypso-style {
      margin-left: 10px;
    }

    div.disabled {
      opacity: .1;
    }

    .download-button {
      float: left;
      width: 20px;
      height: 20px;
      background: url(download.png) center/contain no-repeat;
      margin-right: 10px;
      cursor: pointer; 
    }

    #download em {
      color: #d85656;
    }

    #search {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 500;
      box-shadow: 0 0 10px rgba(0,0,0,.5);
    }

    #search input {
      width: 300px;
      padding: 10px;
      display: block;
    }

    #search-results {
      display: none;
      width: 300px;
      background-color: white;
      border-bottom-left-radius: 5px;
      border-top-left-radius: 5px;
    }

    .search-result {
      padding: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .search-result:hover, .search-result.highlight {
      background-color: #eee;
    }
  </style>
</head>

<body>
  <div id='wrapper'>
    <div id='map'></div>
    <div id='settings'>
      <div class='settings-row type'>
        <p class="settings-title">Map Type</p>
        <div class="settings-section"><label><input type="radio" name="type" checked value="lines"/><span>Contour lines</span></label></div>
        <div class="settings-section"><label><input type="radio" name="type" value="illuminated"/><span>Illuminated contour polygons</span></label></div>
      </div>
      <div class='settings-row unit'>
        <p class="settings-title">Contour Interval</p>
        <div class="settings-section">
          <input type="text" value="500" id="interval-input"/>
          <label><input type="radio" name="unit" value="m"/><span>m</span></label>
          <label><input type="radio" name="unit" checked value="ft"/><span>ft</span></label>
        </div>
        <div class="settings-section">
          <label>Major interval: </label>
          <select id="major">
            <option value="0">None</option>
            <option value="2"></option>
            <option value="5"></option>
            <option value="10"></option>
          </select>
        </div>
      </div>
      <div class='settings-row'>
        <p class="settings-title">Contour Style</p>
        <div id="lines-style">
          <div class="settings-section"><label>Contour color: <input id="line-color" type="color" value ="#8c7556"/></label></div>
          <div class="settings-section"><label>Line weight: <input id="line-width" type="text" value="0.75"/></label> pixels</div>
          <div class="settings-section"><label>Major line weight: <input id="line-width-major" type="text" value="1.5"/></label> pixels</div>
        </div>
        <div id="illuminated-style" style="display: none">
          <div class="settings-section"><label>Highlight color: <input id="highlight-color" type="color" value ="#B1AEA4"/></label></div>
          <div class="settings-section"><label>Shadow color: <input id="shadow-color" type="color" value ="#5b5143"/></label></div>
          <div class="settings-section"><label>Width: <input id="shadow-width" type="text" value="2"/></label> pixels</div>
        </div>
      </div>
      <div class='settings-row'>
        <p class="settings-title">Background style</p>
        <label><input type="radio" name="bg" checked value="none" id="no-bg"/><span>None</span></label>
        <label><input type="radio" name="bg" value="solid" id="solid-bg"/><span>Solid color</span></label>
        <div id="solid-style" class="disabled">
          <input id="solid-color" type="color" value ="#fffcfa"/></label>
        </div>
        <label><input type="radio" name="bg" value="hypso"/><span>Hypsometric tints</span></label>
        <div id="hypso-style" class="disabled">
          <div class="settings-section"><label>Low color: <input id="hypso-low-color" type="color" value ="#486341"/></label></div>
          <div class="settings-section"><label>High color: <input id="hypso-high-color" type="color" value ="#e5d9c9"/></label></div>
        </div>
      </div>
    </div>
    <div id="download">
      <div class='settings-row geojson'>
        <div id="download-geojson" class="download-button"></div>
        <p class="settings-title">GeoJSON</p>
        Download contours for use in GIS or mapping applications. Contours will be exported as overlapping <code>MultiPolygon</code> features, each with an <code>elevation</code> property. <em>This will save geodata only. Styles will not be included!</em>
      </div>
      <div class='settings-row png'>
        <div id="download-png" class="download-button"></div>
        <p class="settings-title">PNG image</p>
        Download a raster image of the map, including your chosen styles.
      </div>
      <div class='settings-row svg'>
        <div id="download-svg" class="download-button"></div>
        <p class="settings-title">SVG</p>
        Download contours as vector graphics. <em>This does not work for illuminated contours! It will export polygons, but you'll have better luck achieving the effect in your favorite graphics editing software.</em>
      </div>
    </div>
    <div id="settings-toggle" title="Edit style"></div>
    <div id="download-toggle" title="Download map or data"></div>
    <div id="search">
      <input type="text" placeholder="Search for places..." />
      <div id="search-results"></div>
    </div>
  </div>
  <script src='contours.js'></script>
</body>
</html>